# 3장. 레디스 기본 개념

# 레디스의 자료 구조

## 1) 문자열

- 최대 512MB의 문자열 데이터 저장 가능
- 키와 아이템이 1:1로 저장되는 유일한 자료 구조

### 명령어

- GET
- SET
    - NX : 지정한 키가 없을 때만 저장
    - XX : 키가 이미 존재할 경우에만 덮어 씀
- INCR
- INCRBY
- DECR
- DECRBY
- MSET
- MGET

## 2) 리스트

- 최대 42억 개의 아이템 저장 가능

### 명령어

- LPUSH
- RPUSH
- LRANGE
- LPOP : 리스트 1번째 아이템 조회 및 삭제
- LTRIM : 범위에 속하지 않는 아이템 삭제
- LINSERT : 원하는 데이터의 앞이나 뒤에 추가
- LSET : 지정한 인덱스의 데이터를 신규 데이터로 덮어 씀
- LINDEX : 원하는 인덱스의 데이터 확인

## 3) 해시

- 필드-값 쌍을 가진 아이템의 집합
- 각 아이템마다 다른 필드 존재 가능

### 명령어

- HSET : 특정 필드에 값 저장
- HGET : 특정 필드 값 조회
- HMGET : 여러 필드의 데이터 조회
- HGETALL : 전체 필드 값 조회

## 4) SET

- 정렬되지 않은 문자열의 모음
- 아이템은 중복되지 않음

### 명령어

- SADD : 아이템 추가
- SMEMBERS : 전체 아이템 조회
- SREM : 아이템 삭제
- SPOP : 아이템 랜덤 조회 및 삭제
- SINTER : SET들의 교집합 조회
- SUNION : SET들의 합집합 조회
- SDIFF : SET들의 차집합 조회

## 5) Sorted Set

- 스코어 값에 따라 정렬되는 고유한 문자열의 집합
- 모든 아이템은 스코어-값 쌍을 가짐
- 저장될 때부터 스코어 값으로 정렬되어 저장
- 같은 스코어를 가진 아이템은 데이터의 사전 순으로 정렬

### 명령어

- ZADD : 아이템 저 장
- ZRANGE : 저장된 데이터 조회 (인덱스 기반 조회)

## 6) 비트맵

- String 자료 구조에 비트 연산을 수행할 수 있도록 확장한 형태
- binary-safe, 최대 512MB 저장 가능

### 명령어

- SETBIT : 비트 저장
- GETBIT : 비트 조회

## 7) hyperloglog

- 원소 집합의 카디널리티 추정
- 대량 데이터에서 중복되지 않는 고유한 값 집계 시 사용
- 중복 제거를 위해 저장된 데이터를 모두 기억하는 SET과 달리 자체적인 방법으로 데이터를 변경해 처리
- 최대 12KB
- 카디널리티 추정 오차 0.81%

### 명령어

- PFADD : 아이템 저장
- PFCOUNT : 저장된 아이템 개수(=카디널리티) 추정

## 8) Geospatial (지리 공간)

- 경도, 위도 데이터 쌍의 집합으로 지리 데이터 저장
- 내부적으로는 Sorted Set으로 저장
- 하나의 자료 구조 내 키는 중복되지 않음

### 명령어

- GEOADD : 경도, 위도, MEMBER 값 저장
- GEOPOS : 저장된 위치 데이터 조회
- GEODIST : 두 아이템 사이의 거리 반환
- GEOSEARCH : 특정 위치를 기준으로 원하는 거리 내 아이템 검색
    - BYRADIUS : 반경 거리 기준
    - BYBOX : 직사각형 거리 기준

## 9) Stream

- 레디스를 메시지 브로커로서 사용할 수 있도록 함
- 전체적인 구조는 카프카에서 영향을 받았음, 소비자 그룹 개념 도입하여 데이터 분산 처리 가능
- `append-only` 방식으로 저장
- 실시간 이벤트 혹은 로그성 데이터의 저장을 위해 사용

# 레디스에서 키를 관리하는 법

## 키의 자동 생성과 삭제

- 키가 존재하지 않을 때 아이템을 넣으면 아이템 삽입 전 빈 자료 구조 생성
- 모든 아이템 삭제 시 키도 자동으로 삭제 (Stream 예외)
- 키가 없는 상태에서 삭제, 크기 조회 등 읽기 전용 커맨드 수행 시 키가 있지만 아이템이 없는 것처럼 동작 (에러 반환 X)

## 키와 관련된 커맨드

- EXISTS : 키 존재 여부 확인
- KEYS : 레디스에 저장된 모든 키 조회, 글롭 패턴 기반 동작
- SCAN : KEYS 대체 명령어, 커서 기반 특정 범위의 키만 조회
- SORT : 키 내부 아이템을 정렬해 반환 (list, set, sorted set)
- RENAME / RENAMENX : 키의 이름 변경, NX의 경우 변경할 키가 존재하지 않을 경우에만 동작
- COPY : 키 복사
- OBJECT : 키에 대한 상세 정보 반환
- FLUSHALL : 레디스에 저장된 모든 키 삭제
- DEL : 키에 저장된 모든 아이템 삭제, 동기로 작동
- UNLINK : 키와 데이터 삭제, 백그라운드에서 다른 스레드에 의해 처리되며 키와 연결된 데이터의 연결을 끊음
- EXPIRE : 키의 만료 시간 지정
- EXPIREAET : 유닉스 타임스탬프에 의해 만료 시간 설정
- EXPIRETIME : 키가 삭제되는 유닉스 타임스탬프를 초 단위로 반환
- TTL : 키가 몇 초 뒤 만료되는지 반환
